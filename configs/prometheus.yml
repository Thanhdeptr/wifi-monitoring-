global:
  scrape_interval: 30s
  evaluation_interval: 30s

rule_files:
  - "alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - 192.168.10.18:9093

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['192.168.10.18:9090']

  - job_name: 'snmp-exporter'
    static_configs:
      - targets: ['192.168.10.18:9116']

  - job_name: 'node_exporter'
    static_configs:
      - targets: ['192.168.10.18:9100']

  # Network interfaces monitoring (WAN1-WAN4)
  - job_name: 'gateway-monitor'
    metrics_path: /snmp
    scrape_timeout: 9s
    scrape_interval: 15s
    params:
      module: [if_mib]
      auth: [public_v2c]
    static_configs:
      - targets: ['192.168.10.1']
        labels:
          device: 'ER605'
          gw: 'GW1'
      - targets: ['192.168.10.2']
        labels:
          device: 'LRT224'
          gw: 'GW2'
      - targets: ['192.168.10.4']
        labels:
          device: 'ER5120'
          gw: 'GW4'
      - targets: ['192.168.10.5']
        labels:
          device: 'ER7206'
          gw: 'GW5'
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: 192.168.10.18:9116

  # Speedtest monitoring - All WAN lines
  - job_name: 'speedtest'
    scrape_interval: 20m  # Default interval for most WANs
    scrape_timeout: 2m
    static_configs:
      # WAN1 - 1h interval (will use 5m due to job-level setting)
      - targets: ['192.168.10.18:9798']
        labels:
          gateway: 'GW1'
          line: 'WAN1'
      
      # WAN2 - 1h interval (will use 5m due to job-level setting)
      - targets: ['192.168.10.18:9799']
        labels:
          gateway: 'GW2'
          gateway1: 'GW5'
          line: 'WAN2'
      
      # WAN3 - 1h interval (will use 5m due to job-level setting)
      - targets: ['192.168.10.18:9800']
        labels:
          gateway: 'GW2'
          gateway1: 'GW5'
          line: 'WAN3'
      
      # WAN4 - 5m interval
      - targets: ['192.168.10.18:9801']
        labels:
          gateway: 'GW4'
          line: 'WAN4'
      
      # WAN5 - 5m interval
      - targets: ['192.168.10.18:9802']
        labels:
          gateway: 'GW4'
          line: 'WAN5'
      
      # WAN6 - 5m interval
      - targets: ['192.168.10.18:9803']
        labels:
          gateway: 'GW4'
          gateway1: 'GW5'
          line: 'WAN6'
      
      # WAN7 - 5m interval
      - targets: ['192.168.10.18:9804']
        labels:
          gateway: 'GW4'
          gateway1: 'GW5'
          line: 'WAN7'
      
      # WAN8 - 1h interval (will use 5m due to job-level setting)
      - targets: ['192.168.10.18:9805']
        labels:
          gateway: 'GW5'
          line: 'WAN8'


  # Omada Controller Exporter
  - job_name: 'omada-exporter'
    scrape_interval: 15s
    scrape_timeout: 9s
    static_configs:
      - targets: ['192.168.10.18:9202']
